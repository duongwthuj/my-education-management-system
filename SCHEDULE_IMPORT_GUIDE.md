# H∆∞·ªõng d·∫´n Import v√† T·∫°o L·ªãch Gi√°o Vi√™n (C·∫≠p nh·∫≠t)

## T·ªïng quan

H·ªá th·ªëng qu·∫£n l√Ω l·ªãch gi√°o vi√™n g·ªìm 4 b∆∞·ªõc:

1. **Teach (L·ªõp c·ªë ƒë·ªãnh)**: Ph√¢n c√¥ng d·∫°y c·ªë ƒë·ªãnh c·ªßa gi√°o vi√™n (m√¥n g√¨, l·ªõp n√†o, ng√†y n√†o, ca n√†o)
2. **WorkSchedule (L·ªãch l√†m vi·ªác/Shift)**: Ca l√†m vi·ªác c·ªßa gi√°o vi√™n (S√°ng/Chi·ªÅu/T·ªëi)
3. **TeachingSchedule (L·ªãch d·∫°y)**: T·ª± ƒë·ªông t·∫°o t·ª´ Teach + WorkSchedule
4. **FreeSchedule (L·ªãch tr·ªëng)**: T·ª± ƒë·ªông t√≠nh to√°n th·ªùi gian r·∫£nh

## Quy tr√¨nh s·ª≠ d·ª•ng M·ªöI

### B∆∞·ªõc 1: Import L·ªõp C·ªë ƒê·ªãnh (Teach)

**V√†o trang "Gi√°o vi√™n" ‚Üí Click "Import L·ªõp C·ªë ƒê·ªãnh"**

ƒê√¢y l√† b∆∞·ªõc quan tr·ªçng nh·∫•t - ƒë·ªãnh nghƒ©a gi√°o vi√™n d·∫°y g√¨, l·ªõp n√†o, ng√†y n√†o, ca n√†o.

#### ƒê·ªãnh d·∫°ng JSON cho Teach

```json
[
  {
    "teacherEmail": "nguyenvana@school.com",
    "subjectCode": "MATH101",
    "className": "10A1",
    "dayOfWeek": "Th·ª© 2",
    "startTime": "08:00",
    "endTime": "09:30"
  },
  {
    "teacherName": "Tr·∫ßn VƒÉn B",
    "subjectName": "V·∫≠t l√Ω",
    "className": "10A2",
    "dayOfWeek": "Th·ª© 3",
    "startTime": "14:00",
    "endTime": "15:30",
    "notes": "L·ªõp chuy√™n"
  }
]
```

#### C√°c tr∆∞·ªùng b·∫Øt bu·ªôc (Teach)

- **teacherEmail** ho·∫∑c **teacherName**: Gi√°o vi√™n
- **subjectCode** ho·∫∑c **subjectName**: M√¥n h·ªçc
- **className**: T√™n l·ªõp c·ªë ƒë·ªãnh (VD: 10A1, 11B2, 12A3)
 - **className**: T√™n l·ªõp c·ªë ƒë·ªãnh (VD: 10A1, 11B2, 12A3)
 - **classType**: `fixed` ho·∫∑c `session`. M·∫∑c ƒë·ªãnh l√† `fixed`.
   - N·∫øu `classType` = `fixed`: b·∫°n c√≥ th·ªÉ cung c·∫•p `className` (ho·∫∑c b·ªè tr·ªëng) ‚Äî h·ªá th·ªëng hi·ªÉu ƒë√¢y l√† l·ªõp c·ªë ƒë·ªãnh.
   - N·∫øu `classType` = `session`: b·∫°n ph·∫£i cung c·∫•p `classId` (ObjectId) tr·ªè t·ªõi m·ªôt document trong collection `classes` ‚Äî ƒë√¢y l√† c√°c l·ªõp ch·ªâ c√≥ 1 bu·ªïi.
- **dayOfWeek**: `Th·ª© 2`, `Th·ª© 3`, ..., `Ch·ªß nh·∫≠t`
- **startTime**: Gi·ªù b·∫Øt ƒë·∫ßu (format: `HH:mm`, v√≠ d·ª•: `08:00`)
- **endTime**: Gi·ªù k·∫øt th√∫c (format: `HH:mm`, v√≠ d·ª•: `09:30`)

#### C√°c tr∆∞·ªùng t√πy ch·ªçn (Teach)

- **notes**: Ghi ch√∫

> **L∆∞u √Ω**: 
> - T·∫•t c·∫£ c√°c l·ªõp ƒë·ªÅu l√† l·ªõp online n√™n kh√¥ng c·∫ßn field `room`. H·ªá th·ªëng t·ª± ƒë·ªông set room = "Online".
> - `startTime` v√† `endTime` ph·∫£i n·∫±m trong khung gi·ªù c·ªßa WorkSchedule (ca l√†m vi·ªác) ƒë·ªÉ ƒë∆∞·ª£c t·∫°o th√†nh TeachingSchedule.

### B∆∞·ªõc 2: Import L·ªãch L√†m Vi·ªác (WorkSchedule/Shift)

**V√†o trang "L·ªãch l√†m vi·ªác gi√°o vi√™n" ‚Üí Click "Import JSON"**

Import ca l√†m vi·ªác c·ªßa gi√°o vi√™n (khung gi·ªù l√†m vi·ªác).

#### ƒê·ªãnh d·∫°ng JSON cho WorkSchedule

```json
[
  {
    "teacherEmail": "nguyenvana@school.com",
    "dayOfWeek": "Th·ª© 2",
    "shift": "S√°ng",
    "startTime": "08:00",
    "endTime": "12:00",
    "duration": 4
  }
]
```

### B∆∞·ªõc 3: T·∫°o L·ªãch D·∫°y + L·ªãch Tr·ªëng (T·ª∞ ƒê·ªòNG)

**Click n√∫t "T·∫°o l·ªãch d·∫°y & l·ªãch tr·ªëng"**

H·ªá th·ªëng s·∫Ω:
1. L·∫•y t·∫•t c·∫£ **Teach** (l·ªõp c·ªë ƒë·ªãnh v·ªõi th·ªùi gian c·ª• th·ªÉ)
2. L·∫•y t·∫•t c·∫£ **WorkSchedule** (ca l√†m vi·ªác)
3. Kh·ªõp Teach v·ªõi WorkSchedule (c√πng teacher, dayOfWeek, v√† th·ªùi gian n·∫±m trong ca l√†m)
4. T·∫°o **TeachingSchedule** v·ªõi th·ªùi gian t·ª´ Teach
5. T√≠nh to√°n kho·∫£ng tr·ªëng ‚Üí t·∫°o **FreeSchedule**

#### V√≠ d·ª• t√≠nh to√°n

**Teach (L·ªõp c·ªë ƒë·ªãnh):**
- Th·ª© 2: 08:00-09:30 (To√°n - 10A1)
- Th·ª© 2: 10:00-11:30 (L√Ω - 10A2)

**WorkSchedule (Ca l√†m):**
- Th·ª© 2, S√°ng: 08:00-12:00

**K·∫øt qu·∫£ t·ª± ƒë·ªông:**
- **TeachingSchedule:**
  - 08:00-09:30: To√°n - 10A1
  - 10:00-11:30: L√Ω - 10A2
- **FreeSchedule:**
  - 09:30-10:00: L·ªãch tr·ªëng (30 ph√∫t)
  - 11:30-12:00: L·ªãch tr·ªëng (30 ph√∫t)

#### V√≠ d·ª• t√≠nh to√°n l·ªãch tr·ªëng

**WorkSchedule:**
- Ca S√°ng: 08:00 - 12:00

**TeachingSchedule:**
- Bu·ªïi 1: 08:30 - 10:00 (To√°n)
- Bu·ªïi 2: 10:30 - 12:00 (L√Ω)

**FreeSchedule (t·ª± ƒë·ªông t·∫°o):**
- 08:00 - 08:30 (30 ph√∫t tr·ªëng tr∆∞·ªõc bu·ªïi 1)
- 10:00 - 10:30 (30 ph√∫t tr·ªëng gi·ªØa 2 bu·ªïi)

## API Endpoints

### Import WorkSchedules

```http
POST /api/import-schedules/work-schedules
Content-Type: application/json

{
  "schedules": [
    {
      "teacherEmail": "teacher@example.com",
      "dayOfWeek": "Th·ª© 2",
      "shift": "S√°ng",
      "startTime": "08:00",
      "endTime": "12:00",
      "duration": 4
    }
  ]
}
```

**Response:**
```json
{
  "success": true,
  "message": "Import ho√†n t·∫•t: 10 th√†nh c√¥ng, 2 th·∫•t b·∫°i",
  "data": {
    "success": [...],
    "failed": [...],
    "total": 12
  }
}
```

### Generate Teaching & Free Schedules

```http
POST /api/import-schedules/generate-teaching-and-free
Content-Type: application/json

{
  "teacherId": "676012345abcdef" // Optional - omit ƒë·ªÉ x·ª≠ l√Ω t·∫•t c·∫£ gi√°o vi√™n
}
```

**Response:**
```json
{
  "success": true,
  "message": "T·∫°o l·ªãch d·∫°y v√† l·ªãch tr·ªëng th√†nh c√¥ng",
  "data": {
    "workSchedulesProcessed": 15,
    "teachingSchedulesGenerated": 30,
    "freeSchedulesGenerated": 25
  }
}
```

## L∆∞u √Ω

### ‚ö†Ô∏è Import WorkSchedule
- Kh√¥ng cho ph√©p import tr√πng (c√πng gi√°o vi√™n, ng√†y, ca)
- Gi√°o vi√™n ph·∫£i t·ªìn t·∫°i trong database tr∆∞·ªõc
- Format th·ªùi gian ph·∫£i ƒë√∫ng `HH:mm`

### ‚ö†Ô∏è Generate Free Schedules
- S·∫Ω **X√ìA** t·∫•t c·∫£ FreeSchedule c≈© c·ªßa gi√°o vi√™n v√† t·∫°o l·∫°i
- Ch·ªâ t·∫°o FreeSchedule cho nh·ªØng WorkSchedule ƒë√£ c√≥ trong DB
- TeachingSchedule ph·∫£i n·∫±m trong khung gi·ªù c·ªßa WorkSchedule

### üí° Best Practices

1. **Import theo th·ª© t·ª±:**
   - Tr∆∞·ªõc ti√™n: Import WorkSchedule
   - Sau ƒë√≥: Th√™m TeachingSchedule th·ªß c√¥ng
   - Cu·ªëi c√πng: Generate FreeSchedule

2. **Ki·ªÉm tra d·ªØ li·ªáu:**
   - ƒê·∫£m b·∫£o gi√°o vi√™n ƒë√£ t·ªìn t·∫°i
   - Ki·ªÉm tra format JSON tr∆∞·ªõc khi import
   - Xem log k·∫øt qu·∫£ import ƒë·ªÉ fix l·ªói

3. **Backup:**
   - N√™n export d·ªØ li·ªáu c≈© tr∆∞·ªõc khi import h√†ng lo·∫°t
   - Test v·ªõi √≠t d·ªØ li·ªáu tr∆∞·ªõc

## V√≠ d·ª• JSON ƒë·∫ßy ƒë·ªß

```json
[
  {
    "teacherEmail": "nguyenvana@school.com",
    "dayOfWeek": "Th·ª© 2",
    "shift": "S√°ng",
    "startTime": "08:00",
    "endTime": "12:00",
    "duration": 4,
    "status": "scheduled",
    "notes": "Ca s√°ng th·ª© 2"
  },
  {
    "teacherEmail": "nguyenvana@school.com",
    "dayOfWeek": "Th·ª© 2",
    "shift": "Chi·ªÅu",
    "startTime": "14:00",
    "endTime": "18:00",
    "duration": 4,
    "status": "scheduled",
    "notes": "Ca chi·ªÅu th·ª© 2"
  },
  {
    "teacherEmail": "tranvanb@school.com",
    "dayOfWeek": "Th·ª© 3",
    "shift": "S√°ng",
    "startTime": "08:00",
    "endTime": "12:00",
    "duration": 4
  },
  {
    "teacherName": "L√™ Th·ªã C",
    "dayOfWeek": "Th·ª© 4",
    "shift": "T·ªëi",
    "startTime": "18:30",
    "endTime": "21:30",
    "duration": 3,
    "status": "scheduled"
  }
]
```

## Troubleshooting

### L·ªói: "Kh√¥ng t√¨m th·∫•y gi√°o vi√™n"
- Ki·ªÉm tra teacherEmail ho·∫∑c teacherName c√≥ ƒë√∫ng kh√¥ng
- ƒê·∫£m b·∫£o gi√°o vi√™n ƒë√£ ƒë∆∞·ª£c t·∫°o trong h·ªá th·ªëng

### L·ªói: "L·ªãch l√†m vi·ªác ƒë√£ t·ªìn t·∫°i"
- Ki·ªÉm tra DB, x√≥a l·ªãch c≈© n·∫øu c·∫ßn
- Ho·∫∑c skip record n√†y trong file JSON

### L·ªói: "ƒê·ªãnh d·∫°ng gi·ªù kh√¥ng h·ª£p l·ªá"
- S·ª≠ d·ª•ng format `HH:mm` (v√≠ d·ª•: `08:00`, `14:30`)
- Kh√¥ng d√πng `8:00` hay `8h00`

### Kh√¥ng t·∫°o ƒë∆∞·ª£c FreeSchedule
- Ki·ªÉm tra ƒë√£ c√≥ WorkSchedule ch∆∞a
- ƒê·∫£m b·∫£o TeachingSchedule n·∫±m trong khung gi·ªù WorkSchedule
